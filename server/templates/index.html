<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>TG Ringer</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="stylesheet" href="/static/css/style.css?v=20251020-b6" />
</head>
<body>
  <header>
    <div>
      <h2>TG Ringer</h2>
      <small>Room: <span id="roomLabel"></span></small>
      <small class="ml-12">Call: <span id="callTimer">00:00:00</span></small>
    </div>
    <div class="controls">
      <button id="testBtn">Test media</button>
      <button id="toggleAudioBtn">Mute mic</button>
      <button id="toggleVideoBtn">Stop video</button>
      <button id="shareScreenBtn">Share screen</button>
      <label class="opt" title="Send system audio from your screen to other participants (may cause echo)">
        <input type="checkbox" id="shareSysAudioToOthersChk" />
        Send system audio to others
      </label>
      <span id="recordIndicator">REC</span>
      <span id="screenIndicator">SCREEN</span>
    </div>
  </header>

  <div class="card">
    <div class="row-inline">
      <input id="roomInput" placeholder="room id" />
      <button id="joinBtn" class="primary">Join</button>
      <button id="hangupBtn">Hang up</button>
      <button id="copyLinkBtn">Copy link</button>

      <div id="ownerRecordControls" style="display:none; gap:8px; flex-wrap:wrap; align-items:center; width:100%; margin-top:8px;">
        <div class="owner-controls-row">
          <button id="recordBtn">Record</button>
          <button id="pauseRecordBtn">Pause</button>
          <button id="stopRecordBtn">Stop</button>
          <label class="opt" title="Send finished recording to bot">
            <input type="checkbox" id="sendToBotChk" checked />
            Send to bot
          </label>
          <label class="opt" title="Include system audio from your screen into server recording">
            <input type="checkbox" id="recordSysAudioChk" />
            Record system audio
          </label>
          <label class="opt" title="Enable dynamics compressor for the mixed audio">
            <input type="checkbox" id="compressAudioChk" />
            Audio compressor
          </label>
        </div>
        <div id="recordStatusRow">
          <span id="recordStatus">Idle</span>
        </div>
      </div>
    </div>
    <small>Grant camera/mic permissions when prompted</small>
  </div>

  <div id="stageContainer">
    <div id="stageHeader">
      <div class="avatar-wrap">
        <img id="stageAvatarImg" class="avatar-img" />
        <div id="stageAvatarInitials" class="avatar-initials"></div>
      </div>
      <span id="stageName">Me</span>
      <span id="stageOwnerBadge" class="owner-badge">(owner)</span>
      <div class="stage-controls">
        <button id="stageFullscreenBtn">Fullscreen</button>
        <button id="stageCollapseBtn">Collapse</button>
      </div>
    </div>
    <div id="stageVideoArea"></div>
  </div>

  <div id="thumbsStripContainer">
    <div id="thumbsStrip"></div>
  </div>

  <script>
    window.APP_BASE_URL = "{{ app_base_url if app_base_url is defined else '' }}";
    window.ICE_SERVERS = [
      {% for u in turn_urls %}{ urls: "{{ u }}" },{% endfor %}
    ];
    window.USER_INFO = {{ user_info_json|safe if user_info_json is defined else "{}" }};
  </script>

  <script src="/static/js/app_bootstrap.js?v=20251020-b8"></script>
  <script src="/static/js/ui_stage.js?v=20251020-b8"></script>
  <script src="/static/js/webrtc_signaling.js?v=20251020-b8"></script>
  <script>
    (function(){
      if (window.App && window.App.state && window.App.state.isOwnerByLink) {
        const ownerControls = document.getElementById('ownerRecordControls');
        if (ownerControls) ownerControls.style.display = 'flex';
        const scr = document.createElement('script');
        scr.src = '/static/js/recording.js?v=20251020-b8';
        document.body.appendChild(scr);
      }
    })();
  </script>
</body>
</html>
